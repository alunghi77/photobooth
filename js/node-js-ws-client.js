// Generated by CoffeeScript 1.3.3
(function() {
  var BinaryClient, Hashids, WebSocket, endpoint, exec, fs, st, sys, ws;

  WebSocket = require('ws');

  sys = require("util");

  exec = require('child_process').exec;

  Hashids = require('hashids');

  BinaryClient = require('binaryjs').BinaryClient;

  fs = require('fs');

  endpoint = 'ws://192.168.1.116:1337';

  st = process.openStdin();

  st.setEncoding('utf8');

  ws = new WebSocket(endpoint);

  ws.on('message', function(data, flags) {
    var dataObj, hash, hashids;
    dataObj = JSON.parse(data);
    if (dataObj.data.text === "take_photo") {
      hashids = new Hashids('yweqwueqwi qwoeoqweuq uoq', 8);
      hash = hashids.encrypt(1);
      exec("sudo raspistill -o ./photos/image_" + hash + ".jpg", function(error, stdout, stderr) {
        var client;
        sys.print(stdout);
        client = new BinaryClient('ws://192.168.1.116:9000');
        return client.on('open', function() {
          var file, parts, stream;
          parts = [];
          file = fs.createWriteStream("./photos/image_" + hash + ".jpg");
          return stream = client.send(file, {
            name: "image_" + hash + ".jpg"
          });
        });
      });
    }
    if (dataObj.data.text === "start_video") {
      return exec("sduo raspivid -o ./videos/video.h264 -t 10000", function(error, stdout, stderr) {
        return sys.print(stdout);
      });
    }
  });

}).call(this);
